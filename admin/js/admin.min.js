$.ajaxSetup({cache:false});arcticmodal_settings={overlay:{css:{opacity:0.9}}};$.fn.padding=function(a){return parseFloat(this.css("padding-"+a))};function windowHeight(){return parseFloat(window.innerHeight)||parseFloat($(window).height())}function windowWidth(){return parseFloat(window.innerWidth)||parseFloat($(window).width())}function arcticModalMaxHG(b){var c=$(b).parent();var a=windowHeight()-c.padding("top")-c.padding("bottom");$(b).css("max-height",a)}arcticmodal_settings.beforeOpen=function(b,a){arcticModalMaxHG(a)};$(window).resize(function(){arcticModalMaxHG(".intopModal:visible")});firstTime=1;clickCookRow=0;selectChange=0;resizeData=$.cookie("resizeData2")?JSON.parse($.cookie("resizeData2")):new Object();myRowData=$.cookie("myRowData")?JSON.parse($.cookie("myRowData")):new Object();pathName=location.pathname.split("/").join("").split(".php").join("").split("admin").join("a")+"d";function initChosen(a){a.chosen({disable_search_threshold:10,no_results_text:"Не найдено:"})}$.datetimepicker.setLocale("ru");function focusFirstRow(a){if($("#"+a).getDataIDs().length>0){$("#"+a).setSelection($("#"+a).getDataIDs()[0]).trigger("click");$("#edit_"+a+"_top").removeClass("ui-state-disabled");$("#del_"+a+"_top").removeClass("ui-state-disabled");$("#print_"+a+"_top").removeClass("ui-state-disabled")}else{$("#edit_"+a+"_top").addClass("ui-state-disabled");$("#del_"+a+"_top").addClass("ui-state-disabled");$("#print_"+a+"_top").addClass("ui-state-disabled")}}function focusRow(a){$("#edit_"+a+"_top").removeClass("ui-state-disabled");$("#del_"+a+"_top").removeClass("ui-state-disabled");$("#print_"+a+"_top").removeClass("ui-state-disabled")}function setMyRow(d,c){var b=$("#"+d).jqGrid("getGridParam","page");var a=$("#"+d).jqGrid("getGridParam","rowNum");myRowData[pathName+d]=c;myRowData[pathName+d+"page"]=b;myRowData[pathName+d+"row"]=a;$.cookie("myRowData",JSON.stringify(myRowData),{expires:365})}function rememberRow(b,a){for(i=2;i<=$("#"+b+" tbody tr").length;i++){if($("#"+b+" tbody tr:nth-child("+i+")").attr("id")==a){setMyRow(b,i)}}}function getRemRow(a){$("#"+a).jqGrid("setGridParam",{page:myRowData[pathName+a+"page"],rowNum:myRowData[pathName+"jqGridrow"]});$("select.ui-pg-selbox").val(myRowData[pathName+"jqGridrow"]);$("#"+a+" tbody tr:nth-child("+myRowData[pathName+a]+")").trigger("click")}function jqGridRemRow(){if(firstTime==1&&window.myRowData[pathName+"jqGridpage"]&&window.myRowData[pathName+"jqGridrow"]){$("#jqGrid").jqGrid("setGridParam",{page:myRowData[pathName+"jqGridpage"],rowNum:myRowData[pathName+"jqGridrow"]});setTimeout("$('#jqGrid').trigger('reloadGrid'); clickCookRow = 1;",10)}else{if(clickCookRow==1&&window.myRowData[pathName+"jqGrid"]&&window.myRowData[pathName+"jqGridrow"]){$("select.ui-pg-selbox").val(myRowData[pathName+"jqGridrow"]);$("#jqGrid tbody tr:nth-child("+myRowData[pathName+"jqGrid"]+")").trigger("click");clickCookRow=0}else{if(selectChange==1){$("#jqGrid tbody tr:nth-child("+myRowData[pathName+"jqGrid"]+")").trigger("click");selectChange=0}else{focusFirstRow("jqGrid")}}}firstTime=0}function setMyColumns(c){var a=$("#"+c).jqGrid("getGridParam","colModel");for(var b=0;b<a.length;b++){if(a[b].hidden==false){resizeData[pathName+a[b].name]=a[b].width}}$.cookie("resizeData2",JSON.stringify(resizeData),{expires:365})}function tabsResize(){var c=Math.round(parseFloat($(".g-tabs-full:visible").width())-parseFloat($(".g-tabs-full:visible .ui-tabs-nav").outerWidth(true))-parseFloat($(".g-tabs-full:visible .ui-tabs-panel:visible").css("margin-left"))-parseFloat($(".g-tabs-full:visible .ui-tabs-panel:visible").css("padding-left"))-parseFloat($(".g-tabs-full:visible .ui-tabs-panel:visible").css("border-left-width"))-parseFloat($(".g-tabs-full:visible .ui-tabs-panel:visible").css("margin-right"))-parseFloat($(".g-tabs-full:visible .ui-tabs-panel:visible").css("padding-right"))-parseFloat($(".g-tabs-full:visible .ui-tabs-panel:visible").css("border-right-width"))-25);var b=$(window).height()-parseFloat($(".main").children(".ui-tabs-nav").outerHeight(true))-parseFloat($(".main").children(".ui-tabs-panel:visible").css("padding-top"))-parseFloat($(".main").children(".ui-tabs-panel:visible").css("padding-bottom"))-parseFloat($(".g-tabs-full:visible .ui-tabs-panel:visible").css("padding-top"))-parseFloat($(".g-tabs-full:visible .ui-tabs-panel:visible").css("padding-bottom"))-parseFloat($(".g-tabs-full:visible .ui-tabs-panel:visible").css("border-top-width"))-parseFloat($(".g-tabs-full:visible .ui-tabs-panel:visible").css("border-bottom-width"));var a=b-parseFloat($(".g-tabs-full:visible .ui-tabs-panel:visible .ui-jqgrid-toppager").outerHeight(true))-parseFloat($(".g-tabs-full:visible .ui-tabs-panel:visible .ui-jqgrid-hdiv").outerHeight(true));$(".g-tabs-full:visible .ui-tabs-panel").width(c);$(".g-tabs-full:visible .ui-tabs-panel").height(b);$(".g-tabs-full:visible .ui-tabs-panel .g-jqgrid").jqGrid("setGridHeight",a)}function modalResize(){$(".ui-jqdialog .FormGrid").css("height",parseFloat($(window).height())-150)}Array.prototype.remove=function(){var e,c=arguments,b=c.length,d;while(b&&this.length){e=c[--b];while((d=this.indexOf(e))!==-1){this.splice(d,1)}}return this};function dataInitFileFunction(g,m,o,s,r,h){s=s||false;h=h||false;function d(e,u,v,t,C,y,x){if((v.find("img[src='"+e+"']").length==0)||(!C)){var w=$("<div></div>");w.addClass("jqGridFormImgContainer__wrap");var B=$("<div></div>");B.addClass("jqGridFormImgContainer__del").append("X").click(function(){var E=$(this).siblings(".jqGridFormImgContainer__img");var D=E.attr("src");E.parent().remove();var G=[];try{G=$.parseJSON($("#"+t).val());G.remove(D)}catch(F){}$("#"+t).val($.toJSON(G))});var z;if(C){z=$("<img />");z.attr("src",e).attr("alt",e).addClass("jqGridFormImgContainer__img").click(function(){window.open(e,"_blank")})}else{z=$("<div>"+u+"</div>").data("src",e).addClass("jqGridFormImgContainer__img").click(function(){window.open(e,"_blank")})}w.append(z);if(y){var A=u.split(".");A.pop();A=A.join(".");w.append('<div><input class="full" type="text" value="'+A+'" /></div><div><input type="text" class="group" /></div>')}w.append(B);v.append(w)}else{if(!x){alert("Такой файл уже добавлен!")}}}function j(x,z,C,A,e,t,u,B,w){$("#"+t).remove();var v=$("<input />");v.attr("type","file").attr("id",t).attr("name",t);if(C){v.prop("multiple",true)}var y={multiple:C,autoUpload:true,url:"/admin/php/file.upload.php",data:{table:x,col:z,id:u},maxSize:FileAPI.MB*70,maxFiles:20,onSelect:function(D,E){if(E.other.length){alert("Некорректный файл!")}},onFileComplete:function(D,H){var E=A.find(".jqGridFormImgContainer");d(H.result,H.file.name,E,e,B,w);var G=[];try{G=$.parseJSON($("#"+e).val())}catch(F){}G.push(H.result);$("#"+e).val($.toJSON(G));j(x,z,C,A,e,t,u,B,w)}};if(B){y.accept="image/*";y.imageSize={maxWidth:10000,maxHeight:10000};y.maxSize=FileAPI.MB*35}v.fileapi(y);A.append(v)}var n=$(g).parent();var b=g.id;var a=g.id+"_file";var f=$(g).parents(".EditTable").find("#ID_"+m).val();j(m,o,s,n,b,a,f,r,h);var c=$("<div></div>").addClass("jqGridFormImgContainer");if(h){c.append("<div><div>Файл</div><div>Название</div><div>Группа</div><div>Действия</div></div>")}try{var p=$.parseJSON($(g).val());var q=[];$.each(p,function(e,t){if($.inArray(t,q)===-1){q.push(t)}});$(g).val($.toJSON(q));for(var k=0;k<q.length;k++){d(q[k],q[k],c,b,r,h,true)}}catch(l){}$(g).after(c);$(g).addClass("i-hidden")}function get_quill_elem(c,b){var a=$("<div id='"+b.id+"' class='g-quill' data-value='"+c+"'>");return a[0]}function get_quill_value(c,a,d){if($(c).length>0){var b=$(c).data("quill");if(a==="get"){return encodeURIComponent(JSON.stringify(b.getContents()))}else{if(a==="set"){b.setContents(JSON.parse(decodeURIComponent(d)))}}}}function quillGetHTML(b){var a=document.createElement("div");(new Quill(a)).setContents(b);return a.getElementsByClassName("ql-editor")[0].innerHTML}function quillGetText(c){var a=document.createElement("div");var b=new Quill(a);b.setContents(c);return b.getText()}function numberFormatter(a,b,d){var c="";if(a){c=(a*1).toString()}return c}function photosFormatter(a,b,d){var c="";if(a){c='<span class="g-hidden">'+a+"</span>";c='<img alt="Фото" class="icon__photo" src="/admin/img/picture.png" />'+c}return c}$(document).ready(function(){$(".admin__exit").click(function(){$.ajax({url:"/admin/php/logout.php",complete:function(){location.reload()}})});$(".main").tabs({load:function(a,b){tabsResize()}});$(window).resize(tabsResize);$(window).resize(modalResize);$(".admin__my").click(function(){var a="0";if($(this).prop("checked")){a=1}$.ajax({url:"/admin/php/onlymy.php",data:{onlymy:a},method:"POST",success:function(){var b=$(".objects").tabs("option","active");$(".objects").tabs("load",b)}})})});function hideLeftTabs(){$(".objects, .dicts").find(".ui-tabs-anchor").each(function(){if(!$(this).data("hide")){var a=$(this).text();$(this).data("hide",a);$(this).html(a.substring(0,1));$(".g-tabs-hide").data("ishidden","true").text("→");tabsResize()}})}function showLeftTabs(){$(".objects, .dicts").find(".ui-tabs-anchor").each(function(){if($(this).data("hide")){$(this).html($(this).data("hide"));$(this).data("hide","");$(".g-tabs-hide").data("ishidden","").text("←");tabsResize()}})}var firstTimeTabs=true;function detailTabs(a){$(a).tabs({load:function(b,c){if((windowWidth()<1000)&&(firstTimeTabs)){hideLeftTabs();firstTimeTabs=false}tabsResize()}}).addClass("ui-tabs-vertical ui-helper-clearfix")}$(document).ready(function(){$(document).on("click",".g-tabs-hide",function(){if($(this).data("ishidden")){showLeftTabs()}else{hideLeftTabs()}})});